static const char CONTENT_HOME_JS[] PROGMEM = 
  "\"use strict\";function _createForOfIteratorHelper(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var o=0,t=function(){};return{s:t,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}var r,a=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if(\"string\"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return\"Map\"===(n=\"Object\"===n&&e.constructor?e.constructor.name:n)||\"Set\"===n?Array.from(e):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function _typeof(e){return(_typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function OpenEVSEError(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:\"\";this.type=e,this.message=t}function OpenEVSERequest(){var t=this;t._done=function(){},t._error=function(){},t._always=function(){},t.done=function(e){return t._done=e,t},t.error=function(e){return t._error=e,t},t.always=function(e){return t._always=e,t}}function OpenEVSE(e){var u=this;u._version=\"0.1\",u._endpoint=e,u.states={0:\"unknown\",1:\"not connected\",2:\"connected\",3:\"charging\",4:\"vent required\",5:\"diode check failed\",6:\"gfci fault\",7:\"no ground\",8:\"stuck relay\",9:\"gfci self-test failure\",10:\"over temperature\",11:\"over current\",254:\"sleeping\",255:\"disabled\"},u._lcd_colors=[\"off\",\"red\",\"green\",\"yellow\",\"blue\",\"violet\",\"teal\",\"white\"],u._status_functions={disable:\"FD\",enable:\"FE\",sleep:\"FS\"},u._lcd_types=[\"monochrome\",\"rgb\"],u._service_levels=[\"A\",\"1\",\"2\"],u.STANDARD_SERIAL_TIMEOUT=.5,u.RESET_SERIAL_TIMEOUT=10,u.STATUS_SERIAL_TIMEOUT=0,u.SYNC_SERIAL_TIMEOUT=.5,u.NEWLINE_MAX_AGE=5,u.CORRECT_RESPONSE_PREFIXES=\"$NK\",u.regex=/\\$([^^]*)(\\^..)?/,u._request=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},e=\"$\"+(Array.isArray(e)?e.join(\"+\"):e),n=new OpenEVSERequest;return $.get(u._endpoint+\"?json=1&rapi=\"+encodeURI(e),function(e){e=e.ret.match(u.regex);null!==e?\"OK\"===(e=e[1].split(\" \"))[0]?(t(e.slice(1)),n._done(e.slice(1))):n._error(new OpenEVSEError(\"OperationFailed\")):n._error(new OpenEVSEError(\"UnexpectedResponse\"))},\"json\").always(function(){n._always()}).fail(function(){n._error(new OpenEVSEError(\"RequestFailed\"))}),n},u._flags=function(n){var o=u._request(\"GE\",function(e){var t=parseInt(e[1],16);isNaN(t)?o._error(new OpenEVSEError(\"ParseError\",'Failed to parse \"'+e[0]+'\"')):n({service_level:1+(1&t),diode_check:0==(2&t),vent_required:0==(4&t),ground_check:0==(8&t),stuck_relay_check:0==(16&t),auto_service_level:0==(32&t),auto_start:0==(64&t),serial_debug:0!=(128&t),lcd_type:0!=(256&t)?\"monochrome\":\"rgb\",gfi_self_test:0==(512&t),temp_check:0==(1024&t)})});return o},u.reset=function(){return u._request(\"FR\")},u.time=function(s){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!1!==e)return u._request([\"S1\",e.getFullYear()-2e3,e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()],function(){u.time(s)});var c=u._request(\"GT\",function(e){var t,n,o,r,a,i;6<=e.length?(t=parseInt(e[0]),n=parseInt(e[1]),o=parseInt(e[2]),r=parseInt(e[3]),a=parseInt(e[4]),i=parseInt(e[5]),isNaN(t)||isNaN(n)||isNaN(o)||isNaN(r)||isNaN(a)||isNaN(i)?c._error(new OpenEVSEError(\"ParseError\",'Could not parse time \"'+e.join(\" \")+'\" arguments')):165==t&&165==n&&165==o&&165==r&&165==a&&85==i?s(new Date(0),!1):(i=new Date(2e3+t,n-1,o,r,a,i),s(i,!0))):c._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return c},u.timer=function(a){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],s=2<arguments.length&&void 0!==arguments[2]&&arguments[2];function c(e){return(e<10?\"0\":\"\")+e}if(!1!==i&&!1!==s){var e=/([01]\\d|2[0-3]):([0-5]\\d)/,t=i.match(e),e=s.match(e);return null!==t&&null!==e?u._request([\"ST\",parseInt(t[1]),parseInt(t[2]),parseInt(e[1]),parseInt(e[2])],function(){u.timer(a)}):!1}var l=u._request(\"GD\",function(e){var t,n,o,r;4<=e.length?(t=parseInt(e[0]),n=parseInt(e[1]),o=parseInt(e[2]),r=parseInt(e[3]),isNaN(t)||isNaN(n)||isNaN(o)||isNaN(r)?l._error(new OpenEVSEError(\"ParseError\",'Could not parse time \"'+e.join(\" \")+'\" arguments')):0===t&&0===n&&0===o&&0===r?a(!1,\"--:--\",\"--:--\"):(i=c(t)+\":\"+c(n),s=c(o)+\":\"+c(r),a(!0,i,s))):l._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return l},u.cancelTimer=function(e){return u._request([\"ST\",0,0,0,0],function(){e()})},u.time_limit=function(n){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!1!==e)return u._request([\"S3\",Math.round(e/15)],function(){u.time_limit(n)});var o=u._request(\"G3\",function(e){var t;1<=e.length?(t=parseInt(e[0]),isNaN(t)?o._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):n(15*t)):o._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return o},u.charge_limit=function(n){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!1!==e)return u._request([\"SH\",e],function(){u.charge_limit(n)});var o=u._request(\"GH\",function(e){var t;1<=e.length?(t=parseInt(e[0]),isNaN(t)?o._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):n(t)):o._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return o},u.ammeter_settings=function(o){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(!1!==e&&!1!==t)return u._request([\"SA\",e,t],function(){o(e,t)});var r=u._request(\"GA\",function(e){var t,n;2<=e.length?(t=parseInt(e[0]),n=parseInt(e[1]),isNaN(t)||isNaN(n)?r._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):o(t,n)):r._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return r},u.current_capacity=function(n){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!1!==e)return u._request([\"SC\",e],function(){u.current_capacity(n)});var o=u._request(\"GE\",function(e){var t;1<=e.length?(t=parseInt(e[0]),isNaN(t)?o._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):n(t)):o._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return o},u.service_level=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return!1!==e?u._request([\"SL\",u._service_levels[e]],function(){u.service_level(t)}):u._flags(function(e){t(e.auto_service_level?0:e.service_level,e.service_level)})},u.current_capacity_range=function(o){var r=u._request(\"GC\",function(e){var t,n;2<=e.length?(t=parseInt(e[0]),n=parseInt(e[1]),isNaN(t)||isNaN(n)?r._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):o(t,n)):r._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return r},u.status=function(o){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!1!==e){e=u._status_functions[e];return u._request([e],function(){u.status(o)})}var r=u._request(\"GS\",function(e){var t,n;1<=e.length?(t=parseInt(e[0]),n=parseInt(e[1]),isNaN(t)||isNaN(n)?r._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):o(t,n)):r._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return r},u.diode_check=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?u._request([\"FF\",\"D\",e?\"1\":\"0\"],function(){u.diode_check(t)}):u._flags(function(e){t(e.diode_check)})},u.gfi_self_test=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?u._request([\"FF F\",e?\"1\":\"0\"],function(){u.gfi_self_test(t)}):u._flags(function(e){t(e.gfi_self_test)})},u.ground_check=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?u._request([\"FF G\",e?\"1\":\"0\"],function(){u.ground_check(t)}):u._flags(function(e){t(e.ground_check)})},u.stuck_relay_check=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?u._request([\"FF R\",e?\"1\":\"0\"],function(){u.stuck_relay_check(t)}):u._flags(function(e){t(e.stuck_relay_check)})},u.vent_required=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?u._request([\"FF V\",e?\"1\":\"0\"],function(){u.vent_required(t)}):u._flags(function(e){t(e.vent_required)})},u.temp_check=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?u._request([\"FF T\",e?\"1\":\"0\"],function(){u.temp_check(t)}):u._flags(function(e){t(e.temp_check)})},u.over_temperature_thresholds=function(o){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(!1!==e&&!1!==t)return u._request([\"SO\",e,t],function(){u.over_temperature_thresholds(o)});var r=u._request(\"GO\",function(e){var t,n;2<=e.length?(t=parseInt(e[0]),n=parseInt(e[1]),isNaN(t)||isNaN(n)?r._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):o(t,n)):r._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return r},u.press_button=function(e){return u._request(\"F1\",function(){e()})},u.setEndpoint=function(e){u._endpoint=e}}function RapiViewModel(e){var r=this,o={ECF_L2:1,ECF_DIODE_CHK_DISABLED:2,ECF_VENT_REQ_DISABLED:4,ECF_GND_CHK_DISABLED:8,ECF_STUCK_RELAY_CHK_DISABLED:16,ECF_AUTO_SVC_LEVEL_DISABLED:32,ECF_AUTO_START_DISABLED:64,ECF_SERIAL_DBG:128,ECF_MONO_LCD:256,ECF_GFI_TEST_DISABLED:512,ECF_TEMP_CHK_DISABLED:1024,ECF_BUTTON_DISABLED:32768},a={ECVF_AUTOSVCLVL_SKIPPED:1,ECVF_HARD_FAULT:2,ECVF_LIMIT_SLEEP:4,ECVF_AUTH_LOCKED:8,ECVF_TIME_LIMIT:16,ECVF_NOGND_TRIPPED:32,ECVF_CHARGING_ON:64,ECVF_GFI_TRIPPED:128,ECVF_EV_CONNECTED:256,ECVF_SESSION_ENDED:512,ECVF_EV_CONNECTED_PREV:1024,ECVF_UI_IN_MENU:2048,ECVF_TIMER_ON:4096,ECVF_CHARGE_LIMIT:8192,ECVF_BOOT_LOCK:16384,ECVF_AMMETER_CAL:32768},t={0:\"EVSE_STATE_UNKNOWN\",1:\"EVSE_STATE_A (not connected)\",2:\"EVSE_STATE_B (connected, ready)\",3:\"EVSE_STATE_C (charging)\",4:\"EVSE_STATE_D (vent required)\",5:\"EVSE_STATE_DIODE_CHK_FAILED\",6:\"EVSE_STATE_GFCI_FAULT\",7:\"EVSE_STATE_NO_GROUND\",8:\"EVSE_STATE_STUCK_RELAY\",9:\"EVSE_STATE_GFI_TEST_FAILED\",10:\"EVSE_STATE_OVER_TEMPERATURE\",11:\"EVSE_STATE_OVER_CURRENT\",254:\"EVSE_STATE_SLEEPING\",255:\"EVSE_STATE_DISABLED\"};r.baseEndpoint=e,r.rapiSend=ko.observable(!1),r.cmd=ko.observable(\"\"),r.ret=ko.observable(\"\"),r.history=ko.observable(\"\"),r.flags=ko.observable(\"\"),r.vflags=ko.observable(\"\"),r.evsestate=ko.observable(\"\"),r.pilotstate=ko.observable(\"\"),r.reading=ko.observable(!1),r.get_commands=[{cmd:\"G0\",ret:ko.observable(\"\"),description:\"get EV connect state\",tokens:[{name:\"connectstate\",val:ko.observable(\"\"),description:\"0=not connected, 1=connected, 2=unknown\"}]},{cmd:\"G3\",ret:ko.observable(\"\"),description:\"get charging time limit\",tokens:[{name:\"cnt\",val:ko.observable(\"\"),description:\"cnt*15 = minutes<br/>= 0 = no time limit\"}]},{cmd:\"G4\",ret:ko.observable(\"\"),description:\"get auth lock (needs AUTH_LOCK defined and AUTH_LOCK_REG undefined)\",tokens:[{name:\"lockstate\",val:ko.observable(\"\"),description:\"0=unlocked, 1=locked\"}]},{cmd:\"GA\",ret:ko.observable(\"\"),description:\"get ammeter settings\",tokens:[{name:\"currentscalefactor\",val:ko.observable(\"\"),description:\"\"},{name:\"currentoffset\",val:ko.observable(\"\"),description:\"\"}]},{cmd:\"GC\",ret:ko.observable(\"\"),description:\"get current capacity info, all values are decimal. <br/> n.b. maxamps,emaxamps values are dependent on the active service level (L1/L2)\",tokens:[{name:\"minamps\",val:ko.observable(\"\"),description:\"min allowed current capacity\"},{name:\"hmaxamps\",val:ko.observable(\"\"),description:\"max hardware allowed current capacity MAX_CURRENT_CAPACITY_Ln\"},{name:\"pilotamps\",val:ko.observable(\"\"),description:\"current capacity advertised by pilot\"},{name:\"cmaxamps\",val:ko.observable(\"\"),description:\"max configured allowed current capacity (saved to EEPROM)\"}]},{cmd:\"GD\",ret:ko.observable(\"\"),description:\"get Delay timer, all values decimal, if timer disabled, starthr=startmin=endhr=endmin=0\",tokens:[{name:\"starthr\",val:ko.observable(\"\"),description:\"\"},{name:\"startmin\",val:ko.observable(\"\"),description:\"\"},{name:\"endhr\",val:ko.observable(\"\"),description:\"\"},{name:\"endmin\",val:ko.observable(\"\"),description:\"\"}]},{cmd:\"GE\",ret:ko.observable(\"\"),description:\"get settings\",tokens:[{name:\"amps\",val:ko.observable(\"\"),description:\"(decimal)\"},{name:\"flags\",val:r.flags,description:\"(hex)\",parsed:ko.computed(function(){var e=[],t=parseInt(r.flags(),16);if(!isNaN(t))for(var n in o)Object.hasOwnProperty.call(o,n)&&t&o[n]&&e.push({val:n});return e})}]},{cmd:\"GF\",ret:ko.observable(\"\"),description:\"get fault counters, all values hex, maximum trip count = 0xFF for any counter\",tokens:[{name:\"gfitripcnt\",val:ko.observable(\"\"),description:\"\"},{name:\"nogndtripcnt\",val:ko.observable(\"\"),description:\"\"},{name:\"stuckrelaytripcnt\",val:ko.observable(\"\"),description:\"\"}]},{cmd:\"GG\",ret:ko.observable(\"\"),description:\"get charging current and voltage.  AMMETER must be defined in order to get amps, otherwise returns -1 amps\",tokens:[{name:\"milliamps\",val:ko.observable(\"\"),description:\"\"},{name:\"millivolts\",val:ko.observable(\"\"),description:\"\"}]},{cmd:\"GH\",ret:ko.observable(\"\"),description:\"get cHarge limit\",tokens:[{name:\"kWh\",val:ko.observable(\"\"),description:\"0 = no charge limit\"}]},{cmd:\"GI\",ret:ko.observable(\"\"),description:\"get MCU ID - requires MCU_ID_LEN to be defined. <br/> n.b. MCU_ID_LEN must be defined in order to get MCU ID WARNING: mcuid is guaranteed to be unique only for the 328PB. Uniqueness is unknown in 328P. The first 6 characters are ASCII, and the rest are hexadecimal.\",tokens:[{name:\"mcuid\",val:ko.observable(\"\"),description:\"AVR serial number, mcuid is 6 ASCII characters followed by 4 hex digits. First hex digit = FF for 328P\"}]},{cmd:\"GM\",ret:ko.observable(\"\"),description:\"get voltMeter settings\",tokens:[{name:\"voltcalefactor\",val:ko.observable(\"\"),description:\"\"},{name:\"voltoffset\",val:ko.observable(\"\"),description:\"\"}]},{cmd:\"GO\",ret:ko.observable(\"\"),description:\"get Overtemperature thresholds, thresholds are in 10ths of a degree Celcius\",tokens:[{name:\"ambientthresh\",val:ko.observable(\"\"),description:\"\"},{name:\"irthresh\",val:ko.observable(\"\"),description:\"\"}]},{cmd:\"GP\",ret:ko.observable(\"\"),description:\"get temPerature (v1.0.3+),  all temperatures are in 10th's of a degree Celcius<br/>if any temperature sensor is not installed, its return value is -2560\",tokens:[{name:\"ds3231temp\",val:ko.observable(\"\"),description:\"temperature from DS3231 RTC\"},{name:\"mcp9808temp\",val:ko.observable(\"\"),description:\"temperature from MCP9808\"},{name:\"tmp007temp\",val:ko.observable(\"\"),description:\"temperature from TMP007\"}]},{cmd:\"GS\",ret:ko.observable(\"\"),description:\"get state\",tokens:[{name:\"evsestate\",val:r.evsestate,description:\"(hex), EVSE_STATE_xxx\",parsed:ko.computed(function(){var e=parseInt(r.evsestate(),16);return!isNaN(e)&&e in t?[{val:t[e]}]:[{val:\"UNKNOWN\"}]})},{name:\"elapsed\",val:ko.observable(\"\"),description:\"(dec), elapsed charge time in seconds of current or last charging session\"},{name:\"pilotstate\",val:r.pilotstate,description:\"(hex), EVSE_STATE_xxx\",parsed:ko.computed(function(){var e=parseInt(r.pilotstate(),16);return!isNaN(e)&&e in t?[{val:t[e]}]:[{val:\"UNKNOWN\"}]})},{name:\"vflags\",val:r.vflags,description:\"(hex), EVCF_xxx\",parsed:ko.computed(function(){var e=[],t=parseInt(r.vflags(),16);if(!isNaN(t))for(var n in a)Object.hasOwnProperty.call(a,n)&&t&a[n]&&e.push({val:n});return e})}]},{cmd:\"GT\",ret:ko.observable(\"\"),description:\"get time (RTC)\",tokens:[{name:\"yr\",val:ko.observable(\"\"),description:\"2-digit year\"},{name:\"mo\",val:ko.observable(\"\"),description:\"\"},{name:\"day\",val:ko.observable(\"\"),description:\"\"},{name:\"hr\",val:ko.observable(\"\"),description:\"\"},{name:\"min\",val:ko.observable(\"\"),description:\"\"},{name:\"sec\",val:ko.observable(\"\"),description:\"\"}]},{cmd:\"GU\",ret:ko.observable(\"\"),description:\"get energy usage (v1.0.3+)\",tokens:[{name:\"Wattseconds\",val:ko.observable(\"\"),description:\"Watt-seconds used this charging session, note you'll divide Wattseconds by 3600 to get Wh\"},{name:\"Whacc\",val:ko.observable(\"\"),description:\"total Wh accumulated over all charging sessions, note you'll divide Wh by 1000 to get kWh\"}]},{cmd:\"GV\",ret:ko.observable(\"\"),description:\"get version\",tokens:[{name:\"firmware_version\",val:ko.observable(\"\"),description:\"\"},{name:\"protocol_version\",val:ko.observable(\"\"),description:\"protocol_version is deprecated. too hard to maintain variants, ignore it, and test commands for compatibility, instead.\"}]},{cmd:\"GY\",ret:ko.observable(\"\"),description:\"Get Hearbeat Supervision Status\",tokens:[{name:\"heartbeatinterval\",val:ko.observable(\"\"),description:\"\"},{name:\"hearbeatcurrentlimit\",val:ko.observable(\"\"),description:\"\"},{name:\"hearbeattrigger\",val:ko.observable(\"\"),description:\"0 - There has never been a missed pulse, <br/>2 - there is a missed pulse, and HS is still in current limit<br/>1 - There was a missed pulse once, but it has since been acknkoledged. Ampacity has been successfully restored to max permitted \"}]}],r.readCount=ko.observable(0),r.read=function(){r.reading(!0),r.readCount(0),r.readNext()},r.regex=/\\$([^^]*)(\\^..)?/,r.readNext=function(){var o;r.readCount()<r.get_commands.length?(o=r.get_commands[r.readCount()],$.get(r.baseEndpoint()+\"/r?json=1&rapi=\"+encodeURI(\"$\"+o.cmd),function(e){o.ret(e.ret);e=e.ret.match(r.regex);if(null!==e){var t=e[1].split(/ +/);if(\"OK\"===t[0])for(var n=0;n<o.tokens.length&&n+1<t.length;n++)o.tokens[n].val(t[n+1])}},\"json\").always(function(){r.readCount(r.readCount()+1),r.readNext()})):r.reading(!1)},r.send=function(){r.rapiSend(!0),$.get(r.baseEndpoint()+\"/r?json=1&rapi=\"+encodeURI(r.cmd()),function(e){r.ret(\">\"+e.ret),r.cmd(e.cmd),r.history(r.history()+\"&gt; \"+e.cmd+\"<br/>&lt; \"+e.ret+\"<br/>\")},\"json\").always(function(){r.rapiSend(!1)})},r.clear=function(){r.history(\"\")}}function TimeZoneViewModel(e){this.name=ko.observable(e.name),this.value=ko.observable(e.name+\"|\"+e.tz)}function ZonesViewModel(e){var o=this,t=ko.pureComputed(function(){return e()+\"/zones.json\"});o.fetching=ko.observable(!1),o.zones=ko.mapping.fromJS([],{key:function(e){return ko.utils.unwrapObservable(e.name)},create:function(e){return new TimeZoneViewModel(e.data)}}),o.initialValue=function(e){e=e.split(\"|\",2);2==e.length?o.zones.push(new TimeZoneViewModel({name:e[0],tz:e[1]})):o.zones.push(new TimeZoneViewModel({name:\"Default\",tz:e[1]}))},o.update=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};o.fetching(!0),$.get(t(),function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push({name:t,tz:e[t]});ko.mapping.fromJS(n,o.zones)},\"json\").always(function(){o.fetching(!1),e()})}}function DummyRequest(){var t=this;t.always=function(e){return e(),t}}function OpenEvseViewModel(e,n,t){var o=this,r=ko.pureComputed(function(){return e()+\"/r\"});o.openevse=new OpenEVSE(r()),r.subscribe(function(e){o.openevse.setEndpoint(e)}),o.time=new TimeViewModel(t),o.createCurrentArray=function(n,e){return Array(e-n+1).fill().map(function(e,t){return{name:n+t+\" A\",value:n+t}})},o.serviceLevels=[{name:\"Auto\",value:0},{name:\"1\",value:1},{name:\"2\",value:2}],o.currentLevels=ko.observableArray(o.createCurrentArray(6,80)),o.timeLimits=[{name:\"none\",value:0},{name:\"1 min\",value:1},{name:\"5 min\",value:5},{name:\"15 min\",value:15},{name:\"30 min\",value:30},{name:\"45 min\",value:45},{name:\"1 hour\",value:60},{name:\"1.5 hours\",value:90},{name:\"2 hours\",value:120},{name:\"2.5 hours\",value:150},{name:\"3 hours\",value:180},{name:\"4 hours\",value:240},{name:\"5 hours\",value:300},{name:\"6 hours\",value:360},{name:\"7 hours\",value:420},{name:\"8 hours\",value:480}],o.chargeLimits=[{name:\"none\",value:0},{name:\"1 kWh\",value:1},{name:\"2 kWh\",value:2},{name:\"3 kWh\",value:3},{name:\"4 kWh\",value:4},{name:\"5 kWh\",value:5},{name:\"6 kWh\",value:6},{name:\"7 kWh\",value:7},{name:\"8 kWh\",value:8},{name:\"9 kWh\",value:9},{name:\"10 kWh\",value:10},{name:\"15 kWh\",value:15},{name:\"20 kWh\",value:20},{name:\"25 kWh\",value:25},{name:\"30 kWh\",value:30},{name:\"35 kWh\",value:35},{name:\"40 kWh\",value:40},{name:\"45 kWh\",value:45},{name:\"50 kWh\",value:50},{name:\"55 kWh\",value:55},{name:\"60 kWh\",value:60},{name:\"70 kWh\",value:70},{name:\"80 kWh\",value:80},{name:\"90 kWh\",value:90}],o.timeLimit=ko.observable(-1),o.chargeLimit=ko.observable(-1),o.selectTimeLimit=function(e){if(o.timeLimit()!==e)for(var t=0;t<o.timeLimits.length;t++){var n=o.timeLimits[t];if(n.value>=e){o.timeLimit(n.value);break}}},o.selectChargeLimit=function(e){if(o.chargeLimit()!==e)for(var t=0;t<o.chargeLimits.length;t++){var n=o.chargeLimits[t];if(n.value>=e){o.chargeLimit(n.value);break}}};var a=[function(){return!1===t.time()?o.openevse.time(o.time.timeUpdate):new DummyRequest},function(){return o.openevse.time_limit(function(e){o.selectTimeLimit(e)})},function(){return o.openevse.charge_limit(function(e){o.selectChargeLimit(e)})}];o.updateCount=ko.observable(0),o.updateTotal=ko.observable(a.length),o.updatingTimeLimit=ko.observable(!1),o.savedTimeLimit=ko.observable(!1),o.updatingChargeLimit=ko.observable(!1),o.savedChargeLimit=ko.observable(!1),o.setForTime=function(e,t){e(!0),setTimeout(function(){e(!1)},t)};var i=!(o.generateCurrentList=function(){var e=n.min_current_hard(),t=n.max_current_hard(),t=o.createCurrentArray(e,t);ko.mapping.fromJS(t,{},o.currentLevels)});function s(e){return/([01]\\d|2[0-3]):([0-5]\\d)/.test(e)}o.subscribe=function(){i||(n.min_current_hard.subscribe(function(){o.generateCurrentList()}),n.max_current_hard.subscribe(function(){n.max_current_soft()>n.max_current_hard()&&n.max_current_soft(n.max_current_hard()),o.generateCurrentList()}),o.generateCurrentList(),o.timeLimit.subscribe(function(t){o.updatingTimeLimit(!0),o.openevse.time_limit(function(e){o.setForTime(o.savedTimeLimit,2e3),t!==e&&o.selectTimeLimit(e)},t).always(function(){o.updatingTimeLimit(!1)})}),o.chargeLimit.subscribe(function(t){o.updatingChargeLimit(!0),o.openevse.charge_limit(function(e){o.setForTime(o.savedChargeLimit,2e3),t!==e&&o.selectChargeLimit(e)},t).always(function(){o.updatingChargeLimit(!1)})}),i=!0)},o.update=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};o.updateCount(0),o.nextUpdate(e)},o.nextUpdate=function(e){(0,a[o.updateCount()])().always(function(){o.updateCount(o.updateCount()+1),o.updateCount()<a.length?o.nextUpdate(e):(o.subscribe(),e())})},o.delayTimerValid=ko.pureComputed(function(){return s(o.delayTimerStart())&&s(o.delayTimerStop())}),o.startDelayTimer=function(){o.updatingDelayTimer(!0),o.openevse.timer(function(){o.delayTimerEnabled(!0)},o.delayTimerStart(),o.delayTimerStop()).always(function(){o.updatingDelayTimer(!1)})},o.stopDelayTimer=function(){o.updatingDelayTimer(!0),o.openevse.cancelTimer(function(){o.delayTimerEnabled(!1)}).always(function(){o.updatingDelayTimer(!1)})},o.restartFetching=ko.observable(!1),o.restart=function(){confirm(\"Restart OpenEVSE? Current config will be saved, takes approximately 10s.\")&&(o.restartFetching(!0),o.openevse.reset().always(function(){o.restartFetching(!1)}))}}function OpenEvseWiFiViewModel(e,t,n){var o=this;o.baseHost=ko.observable(\"\"!==e?e:\"openevse.local\"),o.basePort=ko.observable(t),o.baseProtocol=ko.observable(n),o.baseEndpoint=ko.pureComputed(function(){var e=\"//\"+o.baseHost();return 80!==o.basePort()&&(e+=\":\"+o.basePort()),e}),o.config=new ConfigViewModel(o.baseEndpoint),o.status=new StatusViewModel(o.baseEndpoint),o.rapi=new RapiViewModel(o.baseEndpoint),o.scan=new WiFiScanViewModel(o.baseEndpoint),o.wifi=new WiFiConfigViewModel(o.baseEndpoint,o.config,o.status,o.scan),o.openevse=new OpenEvseViewModel(o.baseEndpoint,o.config,o.status),o.zones=new ZonesViewModel(o.baseEndpoint),o.schedule=new ScheduleViewModel(o.baseEndpoint),o.vehicle=new VehicleViewModel(o.baseEndpoint,o.config,o.status),o.logs=new EventLogViewModel(o.baseEndpoint),o.initialised=ko.observable(!1),o.updating=ko.observable(!1),o.scanUpdating=ko.observable(!1),o.wifi.selectedNet.subscribe(function(e){!1!==e&&o.config.ssid(e.ssid())}),o.config.ssid.subscribe(function(e){o.wifi.setSsid(e)}),o.showMqttInfo=ko.observable(!1),o.showSolarDivert=ko.observable(!1),o.showSafety=ko.observable(!1),o.showVehiclePauseStatus=ko.observable(!1),o.showTeslaAdvancedInfo=ko.observable(!1),o.vehicle.tesla.advanced.subscribe(function(){o.showTeslaAdvancedInfo(!1)}),o.toggle=function(e){e(!e())},o.status.state.subscribe(function(){o.logs.addLog(o.status)}),o.status.flags.subscribe(function(){o.logs.addLog(o.status)}),o.advancedMode=ko.observable(!1),o.advancedMode.subscribe(function(e){o.setCookie(\"advancedMode\",e.toString())}),o.developerMode=ko.observable(!1),o.developerMode.subscribe(function(e){o.setCookie(\"developerMode\",e.toString()),e&&o.advancedMode(!0)});var r=null,a=null;o.status.time.subscribe(function(e){o.openevse.time.timeUpdate(new Date(e))}),o.timeSource=ko.computed({read:function(){return o.config.sntp_enabled()?\"ntp\":o.openevse.time.automaticTime()?\"browser\":\"manual\"},write:function(e){switch(e){case\"ntp\":o.config.sntp_enabled(!0),o.openevse.time.automaticTime(!0);break;case\"browser\":o.config.sntp_enabled(!1),o.openevse.time.automaticTime(!0);break;case\"manual\":o.config.sntp_enabled(!1),o.openevse.time.automaticTime(!1)}}}),o.time_zone=ko.computed({read:function(){return o.config.time_zone()},write:function(e){void 0!==e&&!1===o.zones.fetching()&&o.config.time_zone(e)}});n=\"status\";function i(){var e=o.config.emoncms_server().split(\"://\",2);return 1<e.length?e:[o.config.http_supported_protocols()[0],e[0]]}\"\"!==window.location.hash&&(n=window.location.hash.substr(1)),o.tab=ko.observable(n),o.tab.subscribe(function(e){window.location.hash=\"#\"+e}),o.isSystem=ko.pureComputed(function(){return\"system\"===o.tab()}),o.isServices=ko.pureComputed(function(){return\"services\"===o.tab()}),o.isStatus=ko.pureComputed(function(){return\"status\"===o.tab()}),o.isRapi=ko.pureComputed(function(){return\"rapi\"===o.tab()}),o.isVehicle=ko.pureComputed(function(){return\"vehicle\"===o.tab()}),o.upgradeUrl=ko.observable(\"about:blank\"),o.wifiPassword=new PasswordViewModel(o.config.pass),o.emoncmsApiKey=new PasswordViewModel(o.config.emoncms_apikey),o.mqttPassword=new PasswordViewModel(o.config.mqtt_pass),o.wwwPassword=new PasswordViewModel(o.config.www_password),o.emoncms_protocol=ko.computed({read:function(){return 0==o.config.http_supported_protocols().length?\"\":i()[0]},write:function(e){0<o.config.http_supported_protocols().length&&o.config.emoncms_server(e+\"://\"+i()[1])}}),o.emoncms_server=ko.computed({read:function(){return 0==o.config.http_supported_protocols().length?o.config.emoncms_server():i()[1]},write:function(e){var t,n;0<o.config.http_supported_protocols().length?(t=(1<(n=e.split(\"://\",2)).length?n:i())[0],n=1<n.length?n[1]:e,o.config.emoncms_server(t+\"://\"+n)):o.config.emoncms_server(e)}}),o.config.mqtt_protocol.subscribe(function(e){switch(e){case\"mqtt\":\"8883\"==o.config.mqtt_port()&&o.config.mqtt_port(\"1883\");break;case\"mqtts\":\"1883\"==o.config.mqtt_port()&&o.config.mqtt_port(\"8883\")}}),o.loadedCount=ko.observable(0),o.itemsLoaded=ko.pureComputed(function(){return o.loadedCount()+o.openevse.updateCount()}),o.itemsTotal=ko.observable(4+o.openevse.updateTotal()),o.start=function(){o.updating(!0),o.status.update(function(){o.loadedCount(o.loadedCount()+1),o.config.update(function(){o.loadedCount(o.loadedCount()+1),o.schedule.update(function(){o.loadedCount(o.loadedCount()+1),o.logs.update(function(){o.loadedCount(o.loadedCount()+1),o.status.rapi_connected()?o.openevse.update(o.finishedStarting):(o.finishedStarting(),o.status.rapi_connected.subscribe(function(e){e&&o.config.update(function(){o.openevse.update(function(){})})}))})})}),o.status.connect()}),o.advancedMode(\"true\"===o.getCookie(\"advancedMode\",\"false\")),o.developerMode(\"true\"===o.getCookie(\"developerMode\",\"false\"))},o.finishedStarting=function(){o.initialised(!0),r=setTimeout(o.update,5e3),o.upgradeUrl(o.baseEndpoint()+\"/update\");for(var e=document.getElementsByTagName(\"img\"),t=0;t<e.length;t++)e[t].getAttribute(\"data-src\")&&e[t].setAttribute(\"src\",e[t].getAttribute(\"data-src\"));!1!==o.config.time_zone()&&(o.zones.initialValue(o.config.time_zone()),o.zones.update(function(){o.config.time_zone.valueHasMutated()})),o.status.config_version.subscribe(function(){o.config.update(function(){o.status.update()})}),o.updating(!1)};var s=!(o.update=function(){o.updating()||(o.updating(!0),null!==r&&(clearTimeout(r),r=null),o.status.update(function(){r=setTimeout(o.update,5e3),o.updating(!1)}))});o.startScan=function(){o.scanUpdating()||(s=!0,o.scanUpdating(!0),null!==a&&(clearTimeout(a),a=null),o.scan.update(function(){s&&(a=setTimeout(o.startScan,3e3)),o.scanUpdating(!1)}))},o.stopScan=function(){s=!1,o.scanUpdating()||null!==a&&(clearTimeout(a),a=null)},o.wifiConnecting=ko.observable(!1),o.status.mode.subscribe(function(e){\"STA+AP\"!==e&&\"STA\"!==e||o.wifiConnecting(!1),\"STA+AP\"===e||\"AP\"===e?o.startScan():o.stopScan()}),o.saveNetworkFetching=ko.observable(!1),o.saveNetworkSuccess=ko.observable(!1),o.saveNetwork=function(){\"\"===o.config.ssid()?alert(\"Please select network\"):(o.saveNetworkFetching(!0),o.saveNetworkSuccess(!1),$.post(o.baseEndpoint()+\"/savenetwork\",{ssid:o.config.ssid(),pass:o.config.pass()},function(){o.saveNetworkSuccess(!0),o.wifiConnecting(!0)}).fail(function(){alert(\"Failed to save WiFi config\")}).always(function(){o.saveNetworkFetching(!1)}))},o.saveAdminFetching=ko.observable(!1),o.saveAdminSuccess=ko.observable(!1),o.saveAdmin=function(){o.saveAdminFetching(!0),o.saveAdminSuccess(!1),$.post(o.baseEndpoint()+\"/saveadmin\",{user:o.config.www_username(),pass:o.config.www_password()},function(){o.saveAdminSuccess(!0)}).fail(function(){alert(\"Failed to save Admin config\")}).always(function(){o.saveAdminFetching(!1)})},o.advancedGroup=new ConfigGroupViewModel(o.baseEndpoint,function(){return{hostname:o.config.hostname(),sntp_hostname:o.config.sntp_hostname()}}).done(function(){confirm(\"These changes require a reboot to take effect. Reboot now?\")&&$.post(o.baseEndpoint()+\"/restart\",{},function(){setTimeout(function(){var e=\"http://\"+o.config.hostname()+\".local\";80!=o.basePort()&&(e+=\":\"+o.basePort()),e+=\"/\",window.location.replace(e)},5e3)}).fail(function(){alert(\"Failed to restart\")})}),o.saveEmonCmsFetching=ko.observable(!1),o.saveEmonCmsSuccess=ko.observable(!1),o.saveEmonCms=function(){var e={enable:o.config.emoncms_enabled(),server:o.config.emoncms_server(),apikey:o.config.emoncms_apikey(),node:o.config.emoncms_node(),fingerprint:o.config.emoncms_fingerprint()};!e.enable||\"\"!==e.server&&\"\"!==e.node?e.enable&&32!==e.apikey.length&&!o.emoncmsApiKey.isDummy()?alert(\"Please enter valid Emoncms apikey\"):e.enable&&\"\"!==e.fingerprint&&59!==e.fingerprint.length?alert(\"Please enter valid SSL SHA-1 fingerprint\"):(o.saveEmonCmsFetching(!0),o.saveEmonCmsSuccess(!1),$.post(o.baseEndpoint()+\"/saveemoncms\",e,function(){o.saveEmonCmsSuccess(!0)}).fail(function(){alert(\"Failed to save Admin config\")}).always(function(){o.saveEmonCmsFetching(!1)})):alert(\"Please enter Emoncms server and node\")},o.mqttGroup=new ConfigGroupViewModel(o.baseEndpoint,function(){return{mqtt_enabled:o.config.mqtt_enabled(),divert_enabled:o.config.divert_enabled(),mqtt_protocol:o.config.mqtt_protocol(),mqtt_server:o.config.mqtt_server(),mqtt_port:o.config.mqtt_port(),mqtt_reject_unauthorized:o.config.mqtt_reject_unauthorized(),mqtt_topic:o.config.mqtt_topic(),mqtt_user:o.config.mqtt_user(),mqtt_pass:o.config.mqtt_pass(),mqtt_vrms:o.config.mqtt_vrms()}}).validate(function(e){return o.config.mqtt_enabled()||o.config.divert_enabled(!1),!e.mqtt_enabled||\"\"!==e.mqtt_server||(alert(\"Please enter MQTT server\"),!1)}),o.vehicleStateGroup=new ConfigGroupViewModel(o.baseEndpoint,function(){return!1===o.config.tesla_enabled()&&(o.config.tesla_access_token(\"\"),o.config.tesla_refresh_token(\"\"),o.config.tesla_created_at(0),o.config.tesla_expires_in(0)),{mqtt_vehicle_soc:o.config.mqtt_vehicle_soc(),mqtt_vehicle_range:o.config.mqtt_vehicle_range(),mqtt_vehicle_range_miles:o.config.mqtt_vehicle_range_miles(),mqtt_vehicle_eta:o.config.mqtt_vehicle_eta(),tesla_enabled:o.config.tesla_enabled(),tesla_access_token:o.config.tesla_access_token(),tesla_refresh_token:o.config.tesla_refresh_token(),tesla_created_at:o.config.tesla_created_at(),tesla_expires_in:o.config.tesla_expires_in(),tesla_vehicle_id:o.config.tesla_vehicle_id(),ovms_enabled:o.config.ovms_enabled()}}).validate(function(e){return e.tesla_enabled&&\"\"===e.tesla_access_token?(alert(\"No Tesla API Access token set\"),!1):!e.tesla_enabled||\"\"!==e.tesla_refresh_token||(alert(\"No Tesla API Refresh token set\"),!1)}),o.vehicleStateGroup.success.subscribe(function(e){e&&o.vehicle.tesla.advancedUpdate(!1)}),o.ocppGroup=new ConfigGroupViewModel(o.baseEndpoint,function(){return{ocpp_enabled:o.config.ocpp_enabled(),ocpp_server:o.config.ocpp_server(),ocpp_chargeBoxId:o.config.ocpp_chargeBoxId(),ocpp_idTag:o.config.ocpp_idTag(),tx_start_point:o.config.tx_start_point(),ocpp_suspend_evse:o.config.ocpp_suspend_evse(),ocpp_energize_plug:o.config.ocpp_energize_plug()}}).validate(function(e){if(0==e.ocpp_enabled)return!0;var t,n=e.ocpp_server.trim();if(n.length<=0)return alert(\"Please enter OCPP server URL\"),!1;\"/\"!==n.charAt(n.length-1)&&(n+=\"/\"),n+=e.ocpp_chargeBoxId.trim();try{t=new URL(n)}catch(e){return alert(\"Please enter valid OCPP server URL and valid charge box ID\"),!1}return\"ws:\"===t.protocol||\"wss:\"===t.protocol||(alert(\"OCPP only allows ws: and wss: as protocol\"),!1)}),o.vehicleGroup=new ConfigGroupViewModel(o.baseEndpoint,function(){return{pause_uses_disabled:o.config.pause_uses_disabled()}}),o.config.pause_uses_disabled.subscribe(function(){o.vehicleGroup.save()}),o.displayGroup=new ConfigGroupViewModel(o.baseEndpoint,function(){return{led_brightness:o.config.led_brightness()}}),o.config.led_brightness.subscribe(function(){o.displayGroup.save()}),o.openEvseSetting=function(t){var n=o.config[t],e=new ConfigGroupViewModel(o.baseEndpoint,function(){var e={};return e[t]=n(),e});return n.subscribe(function(){o.config.loaded()&&e.save()}),e},o.openEvseGfciCheckDisabled=o.openEvseSetting(\"gfci_check\"),o.openEvseGroundCheckDisabled=o.openEvseSetting(\"ground_check\"),o.openEvseRelayCheckDisabled=o.openEvseSetting(\"relay_check\"),o.openEvseTempCheckDisabled=o.openEvseSetting(\"temp_check\"),o.openEvseDiodeCheckDisabled=o.openEvseSetting(\"diode_check\"),o.openEvseVentCheckDisabled=o.openEvseSetting(\"vent_check\"),o.openEvseService=o.openEvseSetting(\"service\"),o.openEvseScale=o.openEvseSetting(\"scale\"),o.openEvseOffset=o.openEvseSetting(\"offset\"),o.openEvseMaxCurrentSoft=o.openEvseSetting(\"max_current_soft\"),o.divertGroup=new ConfigGroupViewModel(o.baseEndpoint,function(){return{divert_enabled:o.config.divert_enabled(),mqtt_solar:o.config.mqtt_solar(),mqtt_grid_ie:o.config.mqtt_grid_ie(),divert_PV_ratio:o.config.divert_PV_ratio(),divert_attack_smoothing_factor:o.config.divert_attack_smoothing_factor(),divert_decay_smoothing_factor:o.config.divert_decay_smoothing_factor(),divert_min_charge_time:o.config.divert_min_charge_time()}}).validate(function(e){return!e.divert_enabled||\"\"!==e.mqtt_solar||\"\"!==e.mqtt_grid_ie||(alert(\"Please enter either a Solar PV or Grid I/E feed\"),!1)}),o.chargeMode=new ConfigGroupViewModel(o.baseEndpoint,function(){return{charge_mode:o.config.charge_mode()}}),o.isEcoModeAvailable=ko.pureComputed(function(){return o.config.mqtt_enabled()&&o.config.divert_enabled()&&(\"\"!==o.config.mqtt_solar()||\"\"!==o.config.mqtt_grid_ie())}),o.ecoMode=ko.pureComputed({read:function(){return\"eco\"===o.config.charge_mode()},write:function(e){o.config.charge_mode(e&&o.config.divert_enabled()?\"eco\":\"fast\"),o.chargeMode.save()}}),o.status.divertmode.subscribe(function(e){switch(e){case 1:o.config.charge_mode(\"fast\");break;case 2:o.config.charge_mode(\"eco\")}}),o.haveSolar=ko.pureComputed(function(){return\"\"!==o.config.mqtt_solar()}),o.haveGridIe=ko.pureComputed(function(){return\"\"!==o.config.mqtt_grid_ie()}),o._divertFeedType=\"grid_ie\",o.divertFeedType=ko.computed({read:function(){var e=o.haveSolar()?\"solar\":o.haveGridIe()?\"grid_ie\":o._divertFeedType;return o._divertFeedType=e},write:function(e){\"solar\"===e&&o.haveGridIe()?(o.config.mqtt_solar(o.config.mqtt_grid_ie()),o.config.mqtt_grid_ie(\"\")):\"grid_ie\"===e&&o.haveSolar()&&(o.config.mqtt_grid_ie(o.config.mqtt_solar()),o.config.mqtt_solar(\"\")),o._divertFeedType=e}}),o.divertFeedValue=ko.computed({read:function(){return\"solar\"===o.divertFeedType()?o.config.mqtt_solar():o.config.mqtt_grid_ie()},write:function(e){\"solar\"===o.divertFeedType()?o.config.mqtt_solar(e):o.config.mqtt_grid_ie(e)}}),o.saveOhmKeyFetching=ko.observable(!1),o.saveOhmKeySuccess=ko.observable(!1),o.saveOhmKey=function(){o.saveOhmKeyFetching(!0),o.saveOhmKeySuccess(!1),$.post(o.baseEndpoint()+\"/saveohmkey\",{enable:o.config.ohm_enabled(),ohm:o.config.ohmkey()},function(){o.saveOhmKeySuccess(!0)}).fail(function(){alert(\"Failed to save Ohm key config\")}).always(function(){o.saveOhmKeyFetching(!1)})},o.setTimeFetching=ko.observable(!1),o.setTimeSuccess=ko.observable(!1),o.setTime=function(){o.setTimeFetching(!0),o.setTimeSuccess(!1);var e,t,n=o.openevse.time.automaticTime()?new Date:o.openevse.time.evseTimedate();0==o.status.time()?o.openevse.openevse.time(function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];o.setTimeFetching(!1),o.setTimeSuccess(t),o.openevse.time.timeUpdate(e,t)},n):(!(t={ntp:e=o.config.sntp_enabled(),tz:o.time_zone()})===e&&(t.time=n.toISOString()),$.post(o.baseEndpoint()+\"/settime\",t,function(){o.setTimeFetching(!1),o.setTimeSuccess(!0)}).fail(function(){alert(\"Failed to set time\"),o.setTimeFetching(!1)}))},o.turnOffAccessPointFetching=ko.observable(!1),o.turnOffAccessPointSuccess=ko.observable(!1),o.turnOffAccessPoint=function(){o.turnOffAccessPointFetching(!0),o.turnOffAccessPointSuccess(!1),$.post(o.baseEndpoint()+\"/apoff\",{},function(e){console.log(e),\"\"!==o.status.ipaddress()?setTimeout(function(){window.location=\"http://\"+o.status.ipaddress(),o.turnOffAccessPointSuccess(!0)},3e3):o.turnOffAccessPointSuccess(!0)}).fail(function(){alert(\"Failed to turn off Access Point\")}).always(function(){o.turnOffAccessPointFetching(!1)})},o.factoryResetFetching=ko.observable(!1),o.factoryResetSuccess=ko.observable(!1),o.factoryReset=function(){confirm(\"CAUTION: Do you really want to Factory Reset? All setting and config will be lost.\")&&(o.factoryResetFetching(!0),o.factoryResetSuccess(!1),$.post(o.baseEndpoint()+\"/reset\",{},function(){o.factoryResetSuccess(!0)}).fail(function(){alert(\"Failed to Factory Reset\")}).always(function(){o.factoryResetFetching(!1)}))},o.restartFetching=ko.observable(!1),o.restartSuccess=ko.observable(!1),o.restart=function(){confirm(\"Restart OpenEVSE WiFi? Current config will be saved, takes approximately 10s.\")&&(o.restartFetching(!0),o.restartSuccess(!1),$.post(o.baseEndpoint()+\"/restart\",{},function(){o.restartSuccess(!0)}).fail(function(){alert(\"Failed to restart\")}).always(function(){o.restartFetching(!1)}))},o.setOverrideFetching=ko.observable(!1),o.setOverrideSuccess=ko.observable(!1),o.setOverride=function(){o.setOverrideFetching(!0),o.setOverrideSuccess(!1);var e={state:o.status.isPaused()?\"active\":\"disabled\"};$.ajax({method:\"POST\",url:o.baseEndpoint()+\"/override\",data:JSON.stringify(e),contentType:\"application/json\"}).done(function(){o.setOverrideSuccess(!0)}).fail(function(){alert(\"Failed to set manual override\")}).always(function(){o.setOverrideFetching(!1)})},o.clearOverrideFetching=ko.observable(!1),o.clearOverrideSuccess=ko.observable(!1),o.clearOverride=function(){o.clearOverrideFetching(!0),o.clearOverrideSuccess(!1),$.ajax({method:\"DELETE\",url:o.baseEndpoint()+\"/override\"}).done(function(){o.clearOverrideSuccess(!0)}).fail(function(){alert(\"Failed to clear manual override\")}).always(function(){o.clearOverrideFetching(!1)})},o.updateFetching=ko.observable(!1),o.updateComplete=ko.observable(!1),o.updateError=ko.observable(\"\"),o.updateFilename=ko.observable(\"\"),o.updateLoaded=ko.observable(0),o.updateTotal=ko.observable(1),o.updateProgress=ko.pureComputed(function(){return o.updateLoaded()/o.updateTotal()*100}),o.otaUpdate=function(){var e;\"\"!==o.updateFilename()?(o.updateFetching(!0),o.updateError(\"\"),e=$(\"#upload_form\")[0],e=new FormData(e),$.ajax({url:\"/update\",type:\"POST\",data:e,contentType:!1,processData:!1,xhr:function(){var e;return(e=new window.XMLHttpRequest).upload.addEventListener(\"progress\",function(e){e.lengthComputable&&(o.updateLoaded(e.loaded),o.updateTotal(e.total))},!1),e}}).done(function(e){console.log(e),\"OK\"==e?(o.updateComplete(!0),setTimeout(function(){location.reload()},2500)):o.updateError(e)}).fail(function(){o.updateError(\"HTTP Update failed\")}).always(function(){o.updateFetching(!1)})):o.updateError(\"Filename not set\")},o.setCookie=function(e,t){var n,o=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=\"\";!1!==o&&((n=new Date).setTime(n.getTime()+24*o*60*60*1e3),r=\";expires=\"+n.toUTCString()),document.cookie=e+\"=\"+t+r+\";path=/\"},o.getCookie=function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:\"\",n=e+\"=\",o=document.cookie.split(\";\"),r=0;r<o.length;r++){for(var a=o[r];\" \"===a.charAt(0);)a=a.substring(1);if(0===a.indexOf(n))return a.substring(n.length,a.length)}return t}}function EventInfoViewModel(e){var t=this;\"object\"==_typeof(e)?ko.mapping.fromJS(e,{},this):ko.mapping.fromJS({id:e,state:\"active\",time:\"00:00:00\",days:[]},{},this),this.get=function(){return{id:t.id(),state:t.state(),days:t.days(),time:t.time()}}}function ScheduleViewModel(e){var r=this,a=ko.pureComputed(function(){return e()+\"/schedule\"}),t={key:function(e){return ko.utils.unwrapObservable(e.id)},create:function(e){return new EventInfoViewModel(e.data)}};function n(e){return/([01]\\d|2[0-3]):([0-5]\\d)(:[0-5]\\d)?/.test(e)}function i(e){var t,n=_createForOfIteratorHelper(r.events());try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.id()==e)return o}}catch(e){n.e(e)}finally{n.f()}return!1}r.events=ko.mapping.fromJS([],t),r.fetching=ko.observable(!1),r.delayTimerEnabled=ko.observable(!1),r.updatingDelayTimer=ko.observable(!1),r.update=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};r.fetching(!0),$.get(a(),function(e){ko.mapping.fromJS(e,r.events),r.delayTimerEnabled(r.delayTimerValid())},\"json\").always(function(){r.fetching(!1),e()})},r.delayTimerValid=ko.pureComputed(function(){return n(r.delayTimerStart())&&n(r.delayTimerStop())}),r.startDelayTimer=function(){r.updatingDelayTimer(!0);var e,t=[],n=_createForOfIteratorHelper(r.events());try{for(n.s();!(e=n.n()).done;){var o=e.value;t.push(o.get())}}catch(e){n.e(e)}finally{n.f()}$.post(a(),ko.toJSON(t),function(){r.delayTimerEnabled(!0)}).fail(function(){alert(\"Failed to save schedule\")}).always(function(){r.updatingDelayTimer(!1)})},r.stopDelayTimer=function(){r.updatingDelayTimer(!0);var e,t=[],n=_createForOfIteratorHelper(r.events());try{for(n.s();!(e=n.n()).done;){var o=e.value;t.push(function(o){return new Promise(function(t,n){$.ajax({url:a()+\"/\"+o,type:\"DELETE\",success:function(e){r.events.remove(function(e){return e.id()==o}),t(e)},error:function(e){n(e)}})})}(o.id()))}}catch(e){n.e(e)}finally{n.f()}Promise.all(t).then(function(){r.delayTimerEnabled(!1)}).finally(function(){r.updatingDelayTimer(!1)})},r.delayTimerStart=ko.computed({read:function(){var e=i(1);return!1!==e?e.time():\"--:--\"},write:function(e){var t,n,o;o=e,!(n=\"active\")===(e=i(t=1))&&(e=new EventInfoViewModel(t),r.events.push(e)),e.time(o),e.state(n),e.days([\"monday\",\"tuesday\",\"wednesday\",\"thursday\",\"friday\",\"saturday\",\"sunday\"])}}),r.delayTimerStop=ko.computed({read:function(){var e=i(2);return!1!==e?e.time():\"--:--\"},write:function(e){var t=i(2);!1!==t?t.time(e):(t=new EventInfoViewModel({id:2,state:\"disable\",time:e,days:[\"monday\",\"tuesday\",\"wednesday\",\"thursday\",\"friday\",\"saturday\",\"sunday\"]}),r.events.push(t))}})}function VehicleViewModel(e,t,n){var o=this;this.mqtt_enabled_state=ko.observable(!1),this.mqtt_enabled=ko.computed({read:function(){return\"\"!==t.mqtt_vehicle_soc()||\"\"!==t.mqtt_vehicle_range()||\"\"!==t.mqtt_vehicle_eta()||o.mqtt_enabled_state()},write:function(e){!1===e&&(t.mqtt_vehicle_soc(\"\"),t.mqtt_vehicle_range(\"\"),t.mqtt_vehicle_eta(\"\")),o.mqtt_enabled_state(e)}}),this.has_status=ko.computed(function(){return!1!==n.battery_range()||!1!==n.battery_level()||!1!==n.time_to_full_charge()}),this.tesla=new TeslaViewModel(e,t,n),this.type=ko.pureComputed({read:function(){return t.tesla_enabled()?\"tesla\":t.ovms_enabled()?\"ovms\":o.mqtt_enabled()?\"mqtt\":\"none\"},write:function(e){t.tesla_enabled(\"tesla\"==e),t.ovms_enabled(\"ovms\"==e),o.mqtt_enabled(\"mqtt\"==e)}}),this.show_save=ko.computed(function(){return\"tesla\"!==o.type()||o.tesla.have_credentials()||o.tesla.advanced()}),this.mqtt_vehicle_range_units=ko.computed({read:function(){return t.mqtt_vehicle_range_miles()?\"mi\":\"km\"},write:function(e){t.mqtt_vehicle_range_miles(\"mi\"===e)}})}function TeslaViewModel(t,n,e){var o=this,r=ko.pureComputed(function(){return t()+\"/tesla/vehicles\"});BaseViewModel.call(this,{vehicles:[]},r),this.username=ko.observable(\"\"),this.password=ko.observable(\"\"),this.mfaPassCode=ko.observable(\"\"),this.mfaDeviceName=ko.observable(\"\"),this.fetching=ko.observable(!1),this.success=ko.observable(!1),this.advanced=ko.observable(!1),this.advancedUpdate=ko.observable(!1),e.tesla_vehicle_count.subscribe(function(){o.update()}),n.tesla_access_token.subscribe(function(e){o.advanced()&&\"\"!==e&&(o.advancedUpdate(!0),n.tesla_created_at(Date.now()),n.tesla_expires_in(3888e3))}),this.have_credentials=ko.computed(function(){return!1!==n.tesla_access_token()&&\"\"!==n.tesla_access_token()&&!1!==n.tesla_refresh_token()&&\"\"!==n.tesla_refresh_token()&&0!==n.tesla_created_at()&&!1!==n.tesla_created_at()&&\"\"!==n.tesla_created_at()&&0!==n.tesla_expires_in()&&!1!==n.tesla_expires_in()&&\"\"!==n.tesla_expires_in()&&!1===o.advancedUpdate()});this.showAdvanced=function(){o.advanced(!0)},this.setForTime=function(e,t){e(!0),setTimeout(function(){e(!1)},t)},this.login=function(){o.fetching(!0),o.success(!1),$.ajax(\"https://auth.openevse.com/login\",{method:\"POST\",data:JSON.stringify({username:o.username(),password:o.password(),mfaPassCode:o.mfaPassCode(),mfaDeviceName:o.mfaDeviceName()}),contentType:\"application/json\"}).done(function(e){$.ajax(t()+\"/config\",{method:\"POST\",data:JSON.stringify({tesla_enabled:!0,tesla_access_token:e.access_token,tesla_refresh_token:e.refresh_token,tesla_created_at:e.created_at,tesla_expires_in:e.expires_in}),contentType:\"application/json\"}).done(function(){n.tesla_enabled(!0),n.tesla_access_token(e.access_token),n.tesla_refresh_token(e.refresh_token),n.tesla_created_at(e.created_at),n.tesla_expires_in(e.expires_in),o.setForTime(o.success,2e3)}).fail(function(){}).always(function(){o.fetching(!1)})}).fail(function(){o.fetching(!1)})},this.logout=function(){$.ajax(t()+\"/config\",{method:\"POST\",data:JSON.stringify({tesla_enabled:!1,tesla_access_token:\"\",tesla_refresh_token:\"\",tesla_created_at:\"\",tesla_expires_in:\"\"}),contentType:\"application/json\"}).done(function(){n.tesla_access_token(\"\"),n.tesla_refresh_token(\"\"),n.tesla_created_at(0),n.tesla_expires_in(0),o.advanced(!1),o.setForTime(o.success,2e3)}).fail(function(){}).always(function(){o.fetching(!1)})}}function EventLogEntryViewModel(e,t,n){var o=this;ko.mapping.fromJS(e,{},this),this.key=ko.observable(t+\"-\"+n),this.block=ko.observable(t),this.index=ko.observable(n),this.localTime=this.time.extend({date:!0}),this.vehicle=ko.computed(function(){return 0!=(256&o.evseFlags())?1:0});n=new StateHelperViewModel(this.evseState,this.vehicle);this.isConnected=n.isConnected,this.isReady=n.isReady,this.isCharging=n.isCharging,this.isError=n.isError,this.isEnabled=n.isEnabled,this.isSleeping=n.isSleeping,this.isDisabled=n.isDisabled,this.isPaused=n.isPaused,this.estate=n.estate}function EventLogViewModel(e){var a=this,t=ko.pureComputed(function(){return e()+\"/logs\"});this.block=ko.observable(0);var i=0;ko.mapping.fromJS({min:0,max:0},{},this),this.hasMore=ko.computed(function(){return a.block()>a.min()}),this.events=ko.observableArray([]),this.fetching=ko.observable(!1),this.fetchingBlock=ko.observable(!1),this.update=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};a.fetching(!0),$.get(t(),function(e){ko.mapping.fromJS(e,a),n(a.max(),function(){a.events.length<5&&a.block()>a.min()&&a.updateNext()})},\"json\").always(function(){a.fetching(!1),e()})},this.updateNext=function(){n(a.block()-1)};var s=-1,c=0,n=function(r){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){};a.fetchingBlock(!0),a.block(r),i=0,$.get(t()+\"/\"+r,function(e){var t,n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;a.events.push(new EventLogEntryViewModel(o,r,i++))}}catch(e){n.e(e)}finally{n.f()}s<r&&(s=r,c=i),a.events.sort(l)},\"json\").always(function(){a.fetchingBlock(!1),e()})},o=new Date;this.addLog=function(e){var t=new Date;t-o<1e3||((e=new EventLogEntryViewModel({time:(o=t).toISOString(),type:\"\",managerState:e.status(),evseState:e.state(),evseFlags:e.flags(),elapsed:e.elapsed(),pilot:e.pilot(),energy:e.session_energy(),temperature:e.temp()/10,temperatureMax:e.temp_max()/10,divertMode:e.divertmode()},s,c++)).type(e.isError()?\"warning\":\"information\"),a.events.push(e),a.events.sort(l))};var l=function(e,t){return t.block()!=e.block()?t.block()-e.block():t.index()-e.index()}}function scaleString(e,t,n){return((\"number\"==typeof e?e:parseInt(e))/t).toFixed(n)}function formatUpdate(e){if(!1===e)return\"N/A\";var t=e/60,n=e/3600,o=n/24,r=e.toFixed(0)+\"s\";return 0===e.toFixed(0)?r=\"now\":7<o?r=\"inactive\":2<o?r=o.toFixed(1)+\" days\":2<n?r=n.toFixed(0)+\" hrs\":180<e&&(r=t.toFixed(0)+\" mins\"),r}function updateClass(e){if(!1===e)return\"\";var t=\"updateBad\";return(e=Math.abs(e))<25?t=\"updateGood\":e<60?t=\"updateSlow\":e<7200&&(t=\"updateSlower\"),t}TeslaViewModel.prototype=Object.create(BaseViewModel.prototype),TeslaViewModel.prototype.constructor=TeslaViewModel,function(){var t=window.location.hostname,n=window.location.port,o=window.location.protocol;$(function(){var e=new OpenEvseWiFiViewModel(t,n,o);ko.applyBindings(e),e.start()})}(),ko.extenders.date=function(t){return ko.computed({read:function(){var e=t();return e=(e=\"string\"==typeof e?new Date(e):e).toLocaleString()},write:t})};\n"
  "//# sourceMappingURL=home.js.map\n";
static const char CONTENT_HOME_JS_ETAG[] PROGMEM = "5374d698dc5040d48f815f12f6835217ca9e339a85c9a447521f1c0876d015d2";
